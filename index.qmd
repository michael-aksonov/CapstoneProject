---
title: "Capstone Project"
author: "Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk"
format:
  revealjs:
    navigation-mode: linear
    controls: true
    controls-layout: edges
    controls-tutorial: true
    controls-back-arrows: faded
    logo: logo_primary_color.png
    center: false
editor: visual
---

------------------------------------------------------------------------

::: {style="font-size:65px; text-align: center"}
Transport mode choice analysis
:::

::: {style="font-size:45px; color: grey; text-align: center"}
Part I
:::

![](mode.png){fig-align="center"}

------------------------------------------------------------------------

::: {style="font-size:45px; color: grey"}
Data
:::

:::{style="font-size:25px"}

+-------+----------+----------+-----------+----------+----------+-----+----------+--------+
|       |    GC    |   TTME   |   INVC    |   INVT   |   HINC   |  N  |    p     | True p |
+======:+:========:+:========:+:=========:+:========:+:========:+:===:+:========:+:======:+
|   Air | 102.6476 | 61.00952 | 85.25238  | 133.7095 | 34.54762 | 58  | 0.276190 |  0.28  |
|       | 113.5517 | 46.53448 | 97.56897  | 124.8276 | 41.72414 |     |          |        |
+-------+----------+----------+-----------+----------+----------+-----+----------+--------+
| Train |  130.2   | 35.69048 |  51.3381  | 608.2857 | 34.54762 | 63  |   0.3    |  0.13  |
|       | 106.619  | 28.52381 |  37.46032 | 532.6667 | 23.06349 |     |          |        |
+-------+----------+----------+-----------+----------+----------+-----+----------+--------+
|   Bus | 115.2571 | 41.65714 | 33.45714  | 629.4619 | 34.54762 | 30  | 0.142857 |  0.09  |
|       | 108.1333 |   25.2   |  33.73333 | 618.8333 |   29.7   |     |          |        |
+-------+----------+----------+-----------+----------+----------+-----+----------+--------+
|   Car | 95.41429 |          | 20.99524  | 573.2048 | 34.54762 | 59  | 0.280952 |  0.64  |
|       | 89.08475 |          | 15.64407  | 527.3729 | 42.22034 |     |          |        |
+-------+----------+----------+-----------+----------+----------+-----+----------+--------+

:::

::: {style="font-size:35px"}

Where GC is generalized cost, INVC is in-vehicle cost, INVT is in in-vehicle time, TTME is terminal time and HINC is income.

:::

::: {.footer style="height:55px;background-color:lightgray;z-index:-1;bottom:0%"}
::: footer
Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk
:::
:::

------------------------------------------------------------------------

::: {style="font-size:45px; color: grey"}
Multinomial Logit estimation
:::

::: {style="font-size:35px"}
Multinimial logit for unrestricted and choice based samples are estimated by incorporating true-probability based weights
:::

::: columns
::: column
::: {style="font-size:25px"}

```{r}
#| warning: false
#| echo: false

library(plm)
library(car)
library(stargazer)
library(readxl)
library(ggplot2)
library(dplyr)
library(ggthemes)
library(extrafont)
library(remotes)
library(nnet)
library(margins)
library(mlogit)

###############
# DATA IMPORT #
###############

data("TravelMode", package = "AER")

##############
# TABLE 18.3 #
##############

# boolean column of choice 
TravelMode$choice_accepted <- TravelMode$choice == "yes"
# income of those who choose air
TravelMode$incair <- with(TravelMode, income * (mode == "air"))

#Unweighted Sample Model
US_model<- mlogit(choice_accepted ~ gcost + wait + incair, data = TravelMode, shape = "long", reflevel = "car")


#weights calculation

#calculate in-sample probabilities
TravelMode$p<-NA
TravelMode[TravelMode$mode=="car","p"]<-4*nrow(TravelMode[(TravelMode$mode=="car" & TravelMode$choice=="yes"),])/nrow(TravelMode)
TravelMode[TravelMode$mode=="air","p"]<-4*nrow(TravelMode[(TravelMode$mode=="air" & TravelMode$choice=="yes"),])/nrow(TravelMode)
TravelMode[TravelMode$mode=="train","p"]<-4*nrow(TravelMode[(TravelMode$mode=="train" & TravelMode$choice=="yes"),])/nrow(TravelMode)
TravelMode[TravelMode$mode=="bus","p"]<-4*nrow(TravelMode[(TravelMode$mode=="bus" & TravelMode$choice=="yes"),])/nrow(TravelMode)

#add population statistics
TravelMode$tp<-NA
TravelMode[TravelMode$mode=="car","tp"]<-0.64
TravelMode[TravelMode$mode=="air","tp"]<-0.14
TravelMode[TravelMode$mode=="train","tp"]<-0.13
TravelMode[TravelMode$mode=="bus","tp"]<-0.09

#calculate weights for each transport mode
TravelMode$w<-NA
TravelMode$w<-TravelMode$tp/TravelMode$p

#store weights as numbers
wcar<- TravelMode[TravelMode$mode=="car","w"][1]
wair<- TravelMode[TravelMode$mode=="air","w"][1]
wtrain<- TravelMode[TravelMode$mode=="train","w"][1]
wbus<- TravelMode[TravelMode$mode=="bus","w"][1]

#assign choice-based transport weigts to indiwiduals
TravelMode$w<-NA
TravelMode[TravelMode$individual %in% TravelMode[TravelMode$mode=="air" & TravelMode$choice=="yes","individual"], "w"] <- wair
TravelMode[TravelMode$individual %in% TravelMode[TravelMode$mode=="car" & TravelMode$choice=="yes","individual"], "w"] <- wcar
TravelMode[TravelMode$individual %in% TravelMode[TravelMode$mode=="train" & TravelMode$choice=="yes","individual"], "w"] <- wtrain
TravelMode[TravelMode$individual %in% TravelMode[TravelMode$mode=="bus" & TravelMode$choice=="yes","individual"], "w"] <- wbus

#model with choice-bases corrections
CBW_model<- mlogit(choice_accepted ~ gcost + wait + incair, data = TravelMode, shape = "long", weights=TravelMode$w, alt.var = "mode", reflevel = "car")

#output
stargazer(CBW_model,US_model,type = "text",single.row = TRUE, column.labels = c("Choise-Based","Unweighted"),dep.var.caption = "Accepted Choice", dep.var.labels.include = FALSE, covariate.labels = c("a(Air)","a(Train)","a(Bus)","b(GC)","b(TTME)","b(HINC for Air)"),report = "vct*")

```
:::

:::

::: column

::: {style="font-size:35px"}
As sample shares to dot differ significantly from the population proportions, effect on estimated parameters is modest.
:::

:::

:::

::: {.footer style="height:55px;background-color:lightgray;z-index:-1;bottom:0%"}
::: footer
Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk
:::
:::


------------------------------------------------------------------------

::: {style="font-size:45px; color: grey"}
Predicted choices
:::

::: {style="font-size:35px"}
We than evaluate predicted choices based on fitted probabilities.
:::


```{r, out.width="100%", fig.align='center'}
#| warning: false
#| echo: false

#unweighted
US_matrix<-round(rowsum(US_model[["probabilities"]],as.vector(TravelMode[TravelMode$choice=="yes","mode"])))[c("air","train","bus","car"),c("car","bus","train","air")]
#weighted
CBW_matrix<-round(rowsum(CBW_model[["probabilities"]],as.vector(TravelMode[TravelMode$choice=="yes","mode"])))[c("air","train","bus","car"),c("car","bus","train","air")]

library(reshape2)
library(gridExtra)


p1<-ggplot(data = melt(US_matrix), aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile()+
  geom_text(aes(Var1, Var2, label=value), colour = "white", check_overlap = TRUE)+
  labs(
    title = "Unrestricted sample",
    x = "Predicted",
    y = "Actual"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  theme(legend.position = "none")+
  coord_equal()
p2<-ggplot(data = melt(CBW_matrix), aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile()+
  geom_text(aes(Var1, Var2, label=value), colour = "white", check_overlap = TRUE)+
  labs(
    title = "Choice-Based sample",
    x = "Predicted",
    y = "Actual"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  theme(legend.position = "none")+
  coord_equal()

grid.arrange(p1,p2,ncol=2)

```

::: {.footer style="height:55px;background-color:lightgray;z-index:-1;bottom:0%"}
::: footer
Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk
:::
:::


------------------------------------------------------------------------

::: {style="font-size:45px; color: grey"}
IIA hypothesis
:::

::: {style="font-size:35px"}
Asymptotic covariance matrices are then calculated and Hausman test is conducted, and with Chi-squared 33.3 IIA is rejected.
:::

```{r, out.width="100%", fig.align='center'}
#| warning: false
#| echo: false
#| out-height: 450px


#restricted choice set
FC_model <- mlogit(choice ~ gcost + wait, TravelMode, reflevel = "car",
                   alt.subset = c("car", "bus", "train"))

#asymptotic covariance restricted
asm_FC<-vcov(FC_model)
asm_FC[upper.tri(asm_FC)]<-NA

#asymptotic covariance full
asm_US<-vcov(US_model)[2:5,2:5]
asm_US[upper.tri(asm_US)]<-NA

#Hausman test
iia<-hmftest(US_model,FC_model)

p1<-ggplot(data = melt(asm_US, na.rm = T), aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile()+
  geom_text(aes(Var1, Var2, label=round(value,4)), colour = "white", check_overlap = TRUE)+
  labs(
    title = "Unrestricted Set"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  theme(legend.position = "none",
        axis.ticks.x=element_blank(),
        axis.ticks.y=element_blank(),
        axis.title = element_blank(),
        axis.text.x =  element_blank())+
  coord_equal()+
  scale_x_discrete(limits=rev)

p2<-ggplot(data = melt(asm_FC, na.rm = T), aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile()+
  geom_text(aes(Var1, Var2, label=round(value,4)), colour = "white", check_overlap = TRUE)+
  labs(
    title = "Restricted-Choice Set"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  theme(legend.position = "none",
        axis.ticks.x=element_blank(),
        axis.ticks.y=element_blank(),
        axis.title = element_blank(),
        axis.text.x =  element_blank())+
  coord_equal()+
  scale_x_discrete(limits=rev)

grid.arrange(p1,p2, ncol=2)


```

::: {.footer style="height:55px;background-color:lightgray;z-index:-1;bottom:0%"}
::: footer
Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk
:::
:::


------------------------------------------------------------------------

::: {style="font-size:45px; color: grey"}
Nested Logit
:::

::: {style="font-size:35px"}
As IIA was rejected, nested logit model is then estimated
:::

```{r}
#| warning: false
#| echo: false

# FIML estimate
FIML_model <- mlogit(choice_accepted ~ gcost + wait + incair, data = TravelMode, shape = "long", choice = "choice", alt.var = "mode", reflevel = "car", nests = list(fly = "air", ground = c("bus", "car", "train")), unscaled = TRUE)

#sigmas
sigma_fly.fiml = as.numeric(sqrt(pi^2 / (6*(FIML_model$coefficients["iv:fly"]^2))))
sigma_ground.fiml = as.numeric(sqrt(pi^2 / (6*(FIML_model$coefficients["iv:ground"]^2))))

# Unconditional model estimate
UNCOND_model <- mlogit(choice_accepted ~ gcost + wait + incair, data = TravelMode, shape = "long", choice = "choice", alt.var = "mode", reflevel = "car", unscaled = TRUE)

#sigmas
sigma_fly.un = sqrt(pi^2 / 6)
sigma_ground.un = sqrt(pi^2 / 6)

stargazer(FIML_model,UNCOND_model,type = "text",single.row = TRUE, column.labels = c("FIML","Unconditional"),dep.var.caption = "Accepted Choice", dep.var.labels.include = FALSE)

```


::: {.footer style="height:55px;background-color:lightgray;z-index:-1;bottom:0%"}
::: footer
Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk
:::
:::

------------------------------------------------------------------------

::: {style="font-size:45px; color: grey"}
HEV
:::

::: {style="font-size:35px"}
At last, HEV models are estimated to test heteroscedasticity relaxation assumptions
:::

```{r}
#| warning: false
#| echo: false


#HEV model 
HEV_model <- mlogit(choice_accepted ~ gcost + wait + incair, data = TravelMode,
                    shape = "long", choice = "choice", alt.var = "mode", 
                    reflevel = "car", heterosc = TRUE)

#heteroscedastic HEV 
#there is no capacity in mlogit() to control individual-based heteroscedasticity

#restricted HEV
HEV_RS_model <- mlogit(choice_accepted ~ gcost + wait + incair, data = TravelMode,
                       shape = "long", choice = "choice", alt.var = "mode",
                       reflevel = "car", heterosc = TRUE, alt.subset = c("car", "bus", "air", "train"),
                       constPar = c("sp.train" = 1, "sp.bus" = 1))

#Nested Logit
NL_model <- mlogit(
  choice ~ wait + gcost + incair, TravelMode, reflevel="car",
  nests = list(fly = "air", ground = c("train", "bus", "car")),
  unscaled = T
)


stargazer(HEV_model,HEV_RS_model,NL_model,type = "text",single.row = TRUE, column.labels = c("HEV","Restricted HEV", "Nested Logit"),dep.var.caption = "Accepted Choice", dep.var.labels.include = FALSE)

```

::: {.footer style="height:55px;background-color:lightgray;z-index:-1;bottom:0%"}
::: footer
Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk
:::
:::

------------------------------------------------------------------------

::: {style="font-size:45px; color: grey"}
Final Remarks
:::

::: {style="font-size:35px"}

::: fragment
None of the estimation results suggest preference to one model or another, as likelyhood values are not comparable.
:::

::: fragment
However it is crucial to relax the IIA assumption.
:::

::: fragment
The random parameters model has a significant advantage, and allows a much richer 
specification of the utility function. 
:::

:::


::: {.footer style="height:55px;background-color:lightgray;z-index:-1;bottom:0%"}
::: footer
Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk
:::
:::

------------------------------------------------------------------------

::: {style="font-size:65px; text-align: center"}
Ukrainian Railway freight cost analysis
:::

::: {style="font-size:45px; color: grey; text-align: center"}
Part II
:::

![](freight.png){fig-align="center"}

------------------------------------------------------------------------

::: {style="font-size:45px; color: grey"}
Methodology
:::

::: {style="font-size:35px"}
We start with estimating a Cobb-Douglas cost function with following specification: \begin{gather*}
c=A( \prod_i w_i^{a_i} )y^{a_y}
\end{gather*} Applying logarithm to linarize we achieve: \begin{gather*}
ln(c)=\alpha_0+\sum_i \alpha_i w_i + \alpha_y ln(y)
\end{gather*} where $c$ is total cost, $w_i$ are input costs, $y$ is output and $A$ is some technology factor
:::

::: {.footer style="height:55px;background-color:lightgray;z-index:-1;bottom:0%"}
::: footer
Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk
:::
:::

------------------------------------------------------------------------

::: {style="font-size:45px; color: grey"}
Methodology
:::

::: {style="font-size:35px"}
Marginal costs are then derived as: \begin{gather*}
\frac{\partial c(w,y)}{\partial y}= \alpha_y \frac{c(w,y)}{y}
\end{gather*} and average costs are just: \begin{gather*}
\frac{c(w,y)}{y}
\end{gather*}
:::

::: {.footer style="height:55px;background-color:lightgray;z-index:-1;bottom:0%"}
::: footer
Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk
:::
:::

------------------------------------------------------------------------

::: {style="font-size:45px; color: grey"}
Data
:::

::: {style="font-size:35px"}
For the purpose of this task we have used UZ quartely financial statistics from 2015 to 2020. Grouping different costs (like electricity bills and fuel costs in "utilities") results in the following summary statistic:

::: columns
::: column
```{r}
#| warning: false
#| echo: false

railway_data <- read_excel("railway_data.xlsx")

stargazer(as.data.frame(railway_data[c("Q", "l", "u", "c")]),type = "text", summary.stat = c("sd","mean", "n"), digits = 0)

```
:::

::: column
\

Whehe $Q$ is quantity in tkm, $l$ are costs of labor, $u$ are costs of utilities and $c$ is cost of capital in UAH
:::
:::
:::

::: {.footer style="height:55px;background-color:lightgray;z-index:-1;bottom:0%"}
::: footer
Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk
:::
:::

------------------------------------------------------------------------

::: {style="font-size:45px; color: grey"}
Data
:::

::: {style="font-size:35px"}
Quarterly time series data
:::

::: {style="font-size:11px"}
::: panel-tabset
### Donetsk

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="DONETSK_RAILWAY",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=l, color = "Labor"))+
  geom_line(mapping = aes(y=u, color = "Utility"))+
  geom_line(mapping = aes(y=c, color = "Capital"))+
  labs(
    title = "Quaterly costs",
    subtitle = "(2015-2020)",
    caption = "Source: SSU",
    x = "Number of Quarters since 2015Q1",
    y = "Cost, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='Costs',
                     breaks=c("Labor","Utility","Capital"),
                     values=c("Labor"=rgb(68/255,114/255,169/255), "Utility"=rgb(237/255,125/255,49/255),"Capital"= rgb(144/255,238/255,144/255)))+
  scale_y_continuous(limits = c(42000000,1240000000), breaks = seq(42000000,1240000000,42000000*4))
  


```

### Pridnidrovska

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="PRIDNIPROVSKA_RAILWAY",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=l, color = "Labor"))+
  geom_line(mapping = aes(y=u, color = "Utility"))+
  geom_line(mapping = aes(y=c, color = "Capital"))+
  labs(
    title = "Quaterly costs",
    subtitle = "(2015-2020)",
    caption = "Source: SSU",
    x = "Number of Quarters since 2015Q1",
    y = "Cost, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='Costs',
                     breaks=c("Labor","Utility","Capital"),
                     values=c("Labor"=rgb(68/255,114/255,169/255), "Utility"=rgb(237/255,125/255,49/255),"Capital"= rgb(144/255,238/255,144/255)))+
  scale_y_continuous(limits = c(42000000,1240000000), breaks = seq(42000000,1240000000,42000000*4))
  

```

### Lviv

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="LVIV_RAILWAY",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=l, color = "Labor"))+
  geom_line(mapping = aes(y=u, color = "Utility"))+
  geom_line(mapping = aes(y=c, color = "Capital"))+
  labs(
    title = "Quaterly costs",
    subtitle = "(2015-2020)",
    caption = "Source: SSU",
    x = "Number of Quarters since 2015Q1",
    y = "Cost, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='Costs',
                     breaks=c("Labor","Utility","Capital"),
                     values=c("Labor"=rgb(68/255,114/255,169/255), "Utility"=rgb(237/255,125/255,49/255),"Capital"= rgb(144/255,238/255,144/255)))+
  scale_y_continuous(limits = c(42000000,1240000000), breaks = seq(42000000,1240000000,42000000*4))
  

```

### Odessa

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="ODESSA_RAILWAY",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=l, color = "Labor"))+
  geom_line(mapping = aes(y=u, color = "Utility"))+
  geom_line(mapping = aes(y=c, color = "Capital"))+
  labs(
    title = "Quaterly costs",
    subtitle = "(2015-2020)",
    caption = "Source: SSU",
    x = "Number of Quarters since 2015Q1",
    y = "Cost, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='Costs',
                     breaks=c("Labor","Utility","Capital"),
                     values=c("Labor"=rgb(68/255,114/255,169/255), "Utility"=rgb(237/255,125/255,49/255),"Capital"= rgb(144/255,238/255,144/255)))+
  scale_y_continuous(limits = c(42000000,1240000000), breaks = seq(42000000,1240000000,42000000*4))
  

```

### South-Western

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="SOUTH-WESTERN RAILWAY",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=l, color = "Labor"))+
  geom_line(mapping = aes(y=u, color = "Utility"))+
  geom_line(mapping = aes(y=c, color = "Capital"))+
  labs(
    title = "Quaterly costs",
    subtitle = "(2015-2020)",
    caption = "Source: SSU",
    x = "Number of Quarters since 2015Q1",
    y = "Cost, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='Costs',
                     breaks=c("Labor","Utility","Capital"),
                     values=c("Labor"=rgb(68/255,114/255,169/255), "Utility"=rgb(237/255,125/255,49/255),"Capital"= rgb(144/255,238/255,144/255)))+
  scale_y_continuous(limits = c(42000000,1240000000), breaks = seq(42000000,1240000000,42000000*4))
  

```

### Southern

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="SOUTHERN_RAILWAYS",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=l, color = "Labor"))+
  geom_line(mapping = aes(y=u, color = "Utility"))+
  geom_line(mapping = aes(y=c, color = "Capital"))+
  labs(
    title = "Quaterly costs",
    subtitle = "(2015-2020)",
    caption = "Source: SSU",
    x = "Number of Quarters since 2015Q1",
    y = "Cost, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='Costs',
                     breaks=c("Labor","Utility","Capital"),
                     values=c("Labor"=rgb(68/255,114/255,169/255), "Utility"=rgb(237/255,125/255,49/255),"Capital"= rgb(144/255,238/255,144/255)))+
  scale_y_continuous(limits = c(42000000,1240000000), breaks = seq(42000000,1240000000,42000000*4))
  

```
:::
:::

::: {.footer style="height:55px;background-color:lightgray;z-index:-1;bottom:0%"}
::: footer
Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk
:::
:::

------------------------------------------------------------------------

::: {style="font-size:45px; color: grey"}
Data
:::

::: {style="font-size:35px"}
However, we have to account for inflation.

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="SOUTHERN_RAILWAYS",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=cpi),color = rgb(68/255,114/255,169/255))+
  labs(
    title = "Quaterly CPI",
    subtitle = "(2015-2020)",
    caption = "Source: IMF",
    x = "Number of Quarters since 2015Q1",
    y = "CPI, QoQ"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")
  

```
:::

::: {.footer style="height:55px;background-color:lightgray;z-index:-1;bottom:0%"}
::: footer
Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk
:::
:::

------------------------------------------------------------------------

::: {style="font-size:45px; color: grey"}
Data
:::

::: {style="font-size:35px"}
All financial data is then adjusted for inflation.
:::

::: {style="font-size:11px"}
::: panel-tabset
### Donetsk

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="DONETSK_RAILWAY",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=lc, color = "Labor"))+
  geom_line(mapping = aes(y=uc, color = "Utility"))+
  geom_line(mapping = aes(y=cc, color = "Capital"))+
  labs(
    title = "Quaterly costs - Inflation Adjusted",
    subtitle = "(2015-2020)",
    caption = "Source: Derivation",
    x = "Number of Quarters since 2015Q1",
    y = "Cost, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='Costs',
                     breaks=c("Labor","Utility","Capital"),
                     values=c("Labor"=rgb(68/255,114/255,169/255), "Utility"=rgb(237/255,125/255,49/255),"Capital"= rgb(144/255,238/255,144/255)))+
  scale_y_continuous(limits = c(42000000,1240000000), breaks = seq(42000000,1240000000,42000000*4))
  


```

### Pridnidrovska

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="PRIDNIPROVSKA_RAILWAY",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=lc, color = "Labor"))+
  geom_line(mapping = aes(y=uc, color = "Utility"))+
  geom_line(mapping = aes(y=cc, color = "Capital"))+
  labs(
    title = "Quaterly costs - Inflation Adjusted",
    subtitle = "(2015-2020)",
    caption = "Source: Derivation",
    x = "Number of Quarters since 2015Q1",
    y = "Cost, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='Costs',
                     breaks=c("Labor","Utility","Capital"),
                     values=c("Labor"=rgb(68/255,114/255,169/255), "Utility"=rgb(237/255,125/255,49/255),"Capital"= rgb(144/255,238/255,144/255)))+
  scale_y_continuous(limits = c(42000000,1240000000), breaks = seq(42000000,1240000000,42000000*4))
  

```

### Lviv

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="LVIV_RAILWAY",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=lc, color = "Labor"))+
  geom_line(mapping = aes(y=uc, color = "Utility"))+
  geom_line(mapping = aes(y=cc, color = "Capital"))+
  labs(
    title = "Quaterly costs - Inflation Adjusted",
    subtitle = "(2015-2020)",
    caption = "Source: Derivation",
    x = "Number of Quarters since 2015Q1",
    y = "Cost, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='Costs',
                     breaks=c("Labor","Utility","Capital"),
                     values=c("Labor"=rgb(68/255,114/255,169/255), "Utility"=rgb(237/255,125/255,49/255),"Capital"= rgb(144/255,238/255,144/255)))+
  scale_y_continuous(limits = c(42000000,1240000000), breaks = seq(42000000,1240000000,42000000*4))
  

```

### Odessa

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="ODESSA_RAILWAY",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=lc, color = "Labor"))+
  geom_line(mapping = aes(y=uc, color = "Utility"))+
  geom_line(mapping = aes(y=cc, color = "Capital"))+
  labs(
    title = "Quaterly costs - Inflation Adjusted",
    subtitle = "(2015-2020)",
    caption = "Source: Derivation",
    x = "Number of Quarters since 2015Q1",
    y = "Cost, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='Costs',
                     breaks=c("Labor","Utility","Capital"),
                     values=c("Labor"=rgb(68/255,114/255,169/255), "Utility"=rgb(237/255,125/255,49/255),"Capital"= rgb(144/255,238/255,144/255)))+
  scale_y_continuous(limits = c(42000000,1240000000), breaks = seq(42000000,1240000000,42000000*4))
  

```

### South-Western

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="SOUTH-WESTERN RAILWAY",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=lc, color = "Labor"))+
  geom_line(mapping = aes(y=uc, color = "Utility"))+
  geom_line(mapping = aes(y=cc, color = "Capital"))+
  labs(
    title = "Quaterly costs - Inflation Adjusted",
    subtitle = "(2015-2020)",
    caption = "Source: Derivation",
    x = "Number of Quarters since 2015Q1",
    y = "Cost, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='Costs',
                     breaks=c("Labor","Utility","Capital"),
                     values=c("Labor"=rgb(68/255,114/255,169/255), "Utility"=rgb(237/255,125/255,49/255),"Capital"= rgb(144/255,238/255,144/255)))+
  scale_y_continuous(limits = c(42000000,1240000000), breaks = seq(42000000,1240000000,42000000*4))
  

```

### Southern

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="SOUTHERN_RAILWAYS",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=lc, color = "Labor"))+
  geom_line(mapping = aes(y=uc, color = "Utility"))+
  geom_line(mapping = aes(y=cc, color = "Capital"))+
  labs(
    title = "Quaterly costs - Inflation Adjusted",
    subtitle = "(2015-2020)",
    caption = "Source: Derivation",
    x = "Number of Quarters since 2015Q1",
    y = "Cost, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='Costs',
                     breaks=c("Labor","Utility","Capital"),
                     values=c("Labor"=rgb(68/255,114/255,169/255), "Utility"=rgb(237/255,125/255,49/255),"Capital"= rgb(144/255,238/255,144/255)))+
  scale_y_continuous(limits = c(42000000,1240000000), breaks = seq(42000000,1240000000,42000000*4))
  

```
:::
:::

::: {.footer style="height:55px;background-color:lightgray;z-index:-1;bottom:0%"}
::: footer
Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk
:::
:::

------------------------------------------------------------------------

::: {style="font-size:45px; color: grey"}
Data
:::

::: {style="font-size:35px"}
After quarterly prices of inputs are calculated.
:::

::: {style="font-size:11px"}
::: panel-tabset
### Donetsk

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="DONETSK_RAILWAY",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=plc, color = "Labor"))+
  geom_line(mapping = aes(y=puc, color = "Utility"))+
  geom_line(mapping = aes(y=pcc, color = "Capital"))+
  labs(
    title = "Quaterly input prices - Inflation Adjusted",
    subtitle = "(2015-2020)",
    caption = "Source: Derivation",
    x = "Number of Quarters since 2015Q1",
    y = "Price, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='Prices',
                     breaks=c("Labor","Utility","Capital"),
                     values=c("Labor"=rgb(68/255,114/255,169/255), "Utility"=rgb(237/255,125/255,49/255),"Capital"= rgb(144/255,238/255,144/255)))+
  scale_y_continuous(limits = c(0.015,0.6), breaks = seq(0.015,0.6,0.015*6))
  


```

### Pridnidrovska

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="PRIDNIPROVSKA_RAILWAY",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=plc, color = "Labor"))+
  geom_line(mapping = aes(y=puc, color = "Utility"))+
  geom_line(mapping = aes(y=pcc, color = "Capital"))+
  labs(
    title = "Quaterly input prices - Inflation Adjusted",
    subtitle = "(2015-2020)",
    caption = "Source: Derivation",
    x = "Number of Quarters since 2015Q1",
    y = "Price, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='Prices',
                     breaks=c("Labor","Utility","Capital"),
                     values=c("Labor"=rgb(68/255,114/255,169/255), "Utility"=rgb(237/255,125/255,49/255),"Capital"= rgb(144/255,238/255,144/255)))+
  scale_y_continuous(limits = c(0.015,0.6), breaks = seq(0.015,0.6,0.015*6))

```

### Lviv

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="LVIV_RAILWAY",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=plc, color = "Labor"))+
  geom_line(mapping = aes(y=puc, color = "Utility"))+
  geom_line(mapping = aes(y=pcc, color = "Capital"))+
  labs(
    title = "Quaterly input prices - Inflation Adjusted",
    subtitle = "(2015-2020)",
    caption = "Source: Derivation",
    x = "Number of Quarters since 2015Q1",
    y = "Price, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='Prices',
                     breaks=c("Labor","Utility","Capital"),
                     values=c("Labor"=rgb(68/255,114/255,169/255), "Utility"=rgb(237/255,125/255,49/255),"Capital"= rgb(144/255,238/255,144/255)))+
  scale_y_continuous(limits = c(0.015,0.6), breaks = seq(0.015,0.6,0.015*6))
  

```

### Odessa

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="ODESSA_RAILWAY",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=plc, color = "Labor"))+
  geom_line(mapping = aes(y=puc, color = "Utility"))+
  geom_line(mapping = aes(y=pcc, color = "Capital"))+
  labs(
    title = "Quaterly input prices - Inflation Adjusted",
    subtitle = "(2015-2020)",
    caption = "Source: Derivation",
    x = "Number of Quarters since 2015Q1",
    y = "Price, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='Prices',
                     breaks=c("Labor","Utility","Capital"),
                     values=c("Labor"=rgb(68/255,114/255,169/255), "Utility"=rgb(237/255,125/255,49/255),"Capital"= rgb(144/255,238/255,144/255)))+
  scale_y_continuous(limits = c(0.015,0.6), breaks = seq(0.015,0.6,0.015*6))
```

### South-Western

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="SOUTH-WESTERN RAILWAY",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=plc, color = "Labor"))+
  geom_line(mapping = aes(y=puc, color = "Utility"))+
  geom_line(mapping = aes(y=pcc, color = "Capital"))+
  labs(
    title = "Quaterly input prices - Inflation Adjusted",
    subtitle = "(2015-2020)",
    caption = "Source: Derivation",
    x = "Number of Quarters since 2015Q1",
    y = "Price, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='Prices',
                     breaks=c("Labor","Utility","Capital"),
                     values=c("Labor"=rgb(68/255,114/255,169/255), "Utility"=rgb(237/255,125/255,49/255),"Capital"= rgb(144/255,238/255,144/255)))+
  scale_y_continuous(limits = c(0.015,0.6), breaks = seq(0.015,0.6,0.015*6))

```

### Southern

```{r}
#| warning: false
#| echo: false

ggplot(railway_data[railway_data$railway_name=="SOUTHERN_RAILWAYS",],mapping=aes(x=quarters))+
  geom_line(mapping = aes(y=plc, color = "Labor"))+
  geom_line(mapping = aes(y=puc, color = "Utility"))+
  geom_line(mapping = aes(y=pcc, color = "Capital"))+
  labs(
    title = "Quaterly input prices - Inflation Adjusted",
    subtitle = "(2015-2020)",
    caption = "Source: Derivation",
    x = "Number of Quarters since 2015Q1",
    y = "Price, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='Prices',
                     breaks=c("Labor","Utility","Capital"),
                     values=c("Labor"=rgb(68/255,114/255,169/255), "Utility"=rgb(237/255,125/255,49/255),"Capital"= rgb(144/255,238/255,144/255)))+
  scale_y_continuous(limits = c(0.015,0.6), breaks = seq(0.015,0.6,0.015*6))
```
:::
:::

::: {.footer style="height:55px;background-color:lightgray;z-index:-1;bottom:0%"}
::: footer
Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk
:::
:::

------------------------------------------------------------------------

::: {style="font-size:45px; color: grey"}
Results
:::

::: {style="font-size:35px"}
Now we estimate Coubb-Duglas cost function coefficients using panel data linear regression

::: columns
::: {.column width="70%"}
```{r}

#| warning: false
#| echo: false

model <- plm(log(tc) ~ log(plc) + log(puc)
             + log(pcc) + log(Q) + network_length,
             data = railway_data, index = c("railway_name","quarters"))

stargazer(model, type = "text",
          covariate.labels = c("ln(Price of Labor)", "ln(Price of Utilities)", "ln(Price of Capital)","ln(Output)"),
          dep.var.labels   = "ln(Total Cost)",
          single.row = TRUE)

```
:::

::: {.column width="30%"}
As we can see, all coefficients sum to 1, but this has to be checked
:::
:::
:::

::: {.footer style="height:55px;background-color:lightgray;z-index:-1;bottom:0%"}
::: footer
Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk
:::
:::

------------------------------------------------------------------------

::: {style="font-size:45px; color: grey"}
Results
:::

::: {style="font-size:35px"}
Test linear hypothesis:

```{r}

#| warning: false
#| echo: false
linearHypothesis(model, "log(plc) + log(puc) + log(pcc) + log(Q) = 1" )

```

We fail to reject the null, so our coefficients are OK.
:::

::: {.footer style="height:55px;background-color:lightgray;z-index:-1;bottom:0%"}
::: footer
Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk
:::
:::

------------------------------------------------------------------------

::: {style="font-size:45px; color: grey"}
Results
:::

::: {style="font-size:35px"}
At last we calculate yearly average costs and compare them with actual $TR/Q$ to make tariff recommendation

```{r}
#| warning: false
#| echo: false
earnings_data <- read_excel("earnings_data.xlsx", 
    sheet = "earnings_data")
```

::: {style="font-size:11px"}
::: panel-tabset
### Donetsk

```{r}
#| warning: false
#| echo: false
#| out-height: 400px
#| out-width: 700px

ggplot(earnings_data[earnings_data$railway_name=="DONETSK_RAILWAY",],mapping = aes(x=year))+
  geom_line(mapping = aes(y=TRQ, color="TR/Q"))+
  geom_line(mapping = aes(y=estimated, color = "Estimation"))+
  labs(
    subtitle = "(2015-2020)",
    caption = "Source: Derivation",
    x = "Number of Quarters since 2015Q1",
    y = "Cost, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='A',
                     breaks=c("TR/Q","Estimation"),
                     values=c("TR/Q"=rgb(68/255,114/255,169/255),"Estimation"=rgb(237/255,125/255,49/255)))+
  scale_y_continuous(limits = c(0.1,0.5), breaks = seq(0.1,0.5,0.1))
  

```

### Pridnidrovska

```{r}
#| warning: false
#| echo: false

ggplot(earnings_data[earnings_data$railway_name=="PRIDNIPROVSKA_RAILWAY",],mapping = aes(x=year))+
  geom_line(mapping = aes(y=TRQ, color="TR/Q"))+
  geom_line(mapping = aes(y=estimated, color = "Estimation"))+
  labs(
    subtitle = "(2015-2020)",
    caption = "Source: Derivation",
    x = "Number of Quarters since 2015Q1",
    y = "Cost, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='',
                     breaks=c("TR/Q","Estimation"),
                     values=c("TR/Q"=rgb(68/255,114/255,169/255), "Estimation"=rgb(237/255,125/255,49/255)))+
  scale_y_continuous(limits = c(0.1,0.5), breaks = seq(0.1,0.5,0.1))
  

```

### Lviv

```{r}
#| warning: false
#| echo: false

ggplot(earnings_data[earnings_data$railway_name=="LVIV_RAILWAY",],mapping = aes(x=year))+
  geom_line(mapping = aes(y=TRQ, color="TR/Q"))+
  geom_line(mapping = aes(y=estimated, color = "Estimation"))+
  labs(
    subtitle = "(2015-2020)",
    caption = "Source: Derivation",
    x = "Number of Quarters since 2015Q1",
    y = "Cost, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='',
                     breaks=c("TR/Q","Estimation"),
                     values=c("TR/Q"=rgb(68/255,114/255,169/255), "Estimation"=rgb(237/255,125/255,49/255)))+
  scale_y_continuous(limits = c(0.1,0.5), breaks = seq(0.1,0.5,0.1))
  

```

### Odessa

```{r}
#| warning: false
#| echo: false

ggplot(earnings_data[earnings_data$railway_name=="ODESSA_RAILWAY",],mapping = aes(x=year))+
  geom_line(mapping = aes(y=TRQ, color="TR/Q"))+
  geom_line(mapping = aes(y=estimated, color = "Estimation"))+
  labs(
    subtitle = "(2015-2020)",
    caption = "Source: Derivation",
    x = "Number of Quarters since 2015Q1",
    y = "Cost, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='',
                     breaks=c("TR/Q","Estimation"),
                     values=c("TR/Q"=rgb(68/255,114/255,169/255), "Estimation"=rgb(237/255,125/255,49/255)))+
  scale_y_continuous(limits = c(0.1,0.5), breaks = seq(0.1,0.5,0.1))
  

```

### South-Western

```{r}
#| warning: false
#| echo: false

ggplot(earnings_data[earnings_data$railway_name=="SOUTH-WESTERN RAILWAY",],mapping = aes(x=year))+
  geom_line(mapping = aes(y=TRQ, color="TR/Q"))+
  geom_line(mapping = aes(y=estimated, color = "Estimation"))+
  labs(
    subtitle = "(2015-2020)",
    caption = "Source: Derivation",
    x = "Number of Quarters since 2015Q1",
    y = "Cost, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='',
                     breaks=c("TR/Q","Estimation"),
                     values=c("TR/Q"=rgb(68/255,114/255,169/255), "Estimation"=rgb(237/255,125/255,49/255)))+
  scale_y_continuous(limits = c(0.1,0.5), breaks = seq(0.1,0.5,0.1))
  

```

### Southern

```{r}
#| warning: false
#| echo: false

ggplot(earnings_data[earnings_data$railway_name=="SOUTHERN_RAILWAYS",],mapping = aes(x=year))+
  geom_line(mapping = aes(y=TRQ, color="TR/Q"))+
  geom_line(mapping = aes(y=estimated, color = "Estimation"))+
  labs(
    subtitle = "(2015-2020)",
    caption = "Source: Derivation",
    x = "Number of Quarters since 2015Q1",
    y = "Cost, UAH"
  )+
  theme_bw(base_size = 14, base_family = "Segoe UI Light")+
  scale_color_manual(name='',
                     breaks=c("TR/Q","Estimation"),
                     values=c("TR/Q"=rgb(68/255,114/255,169/255), "Estimation"=rgb(237/255,125/255,49/255)))+
  scale_y_continuous(limits = c(0.1,0.5), breaks = seq(0.1,0.5,0.1))
  

```
:::
:::
:::

::: {.footer style="height:55px;background-color:lightgray;z-index:-1;bottom:0%"}
::: footer
Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk
:::
:::

------------------------------------------------------------------------

::: {style="font-size:45px; color: grey"}
Results
:::

::: {style="font-size:35px"}
Judging by estimation results, our recommendations are:

\

::: fragment
All railways tariffs are sub-optimal
:::

\

::: fragment
All railways freight tariffs have to be increased significantly
:::
:::

::: {.footer style="height:55px;background-color:lightgray;z-index:-1;bottom:0%"}
::: footer
Mykhailo Aksonov - Yevhenia Mitriakhina - Daniil Minakov - Iryna Pavliuk
:::
:::
